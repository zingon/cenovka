<?php $__env->startSection('content'); ?>
<p style="text-align: right; padding-right: 20px">
	<a href="<?php echo route('category.edit'); ?>" class="btn btn-primary modalLink"><span class="glyphicon glyphicon-pencil"></span>  Editovat Kategorie</a>
	<a href="<?php echo route('category.create'); ?>" class="btn btn-success modalLink" data-dismiss="modal" aria-label="Close"><span class="glyphicon glyphicon-plus"></span>  Nová Kategorie</a>

	<a href="<?php echo route('item.create'); ?>" class="btn btn-success modalLink"><span class="glyphicon glyphicon-plus"></span>  Nová Položka</a>
</p>
<table class="table table-striped table-bordered" id="mainTable">
		<thead>
		<tr>
			<th>Kod</th>
			<th>Název</th>
			<th>Cena</th>
			<th>MJ</th>
			<th>Poznámka</th>
			<th><span class="glyphicon glyphicon-pencil"></span></th>
			<th><span class="glyphicon glyphicon-remove"></span></th>
			
		</tr>
		</thead>
		<tbody id="items">
			<?php foreach($items as $item): ?>
			<tr>
				<td><?php echo e($item->code); ?></td>
				<td><?php echo e($item->name); ?></td>
				<td><?php echo e($item->price); ?></td>
				<td><?php echo e($item->unit); ?></td>
				<td><?php echo e($item->note); ?></td>
				<td><a href='<?php echo URL::route("item.edit",$item->id); ?>' class="glyphicon glyphicon-pencil btn btn-primary modalLink"></a></td>
				<td><?php echo Form::destroy('item',$item->id); ?></td>
			</tr>
			<?php endforeach; ?>
		</tbody>
	</table>
<?php $__env->stopSection(); ?>
<?php $__env->startSection('script'); ?>
<script type="text/javascript">
function getItemsByCategory(id,to){
	$.get('/category/'+id,function(html){
		$(to).empty();
		$(to).append(html);
		renewModals();
	});
}
$(function() {

	var cat = 0;
	$.get("<?php echo URL::route('category.index'); ?>",function(data) {
		$("#sideNav").html(data);
		console.log(document.location.hash);
		if(document.location.hash.length){
			getItemsByCategory(document.location.hash.replace("#",""),'#items')
			cat = document.location.hash.replace("#","");
		}
		window.onhashchange = function() {
			var id = document.location.hash; 
			id = id.replace("#","");
			cat = id;
			getItemsByCategory(id,"#items"); 
			
		};
	});

	$( "#items" ).sortable({
	  start: function(event, ui) {
		ui.item.startPos = ui.item.index();
	  },
	  stop: function(event, ui){
	  	if(ui.item.startPos!=ui.item.index()){
			$.post("<?php echo route('changePosition'); ?>",({"from": ui.item.startPos,"to": ui.item.index(),'category':cat}));
		}
	  }
	});
	$( "#items" ).disableSelection();


  });

</script>
<?php $__env->stopSection(); ?>
<?php echo $__env->make('layout.main', array_except(get_defined_vars(), array('__data', '__path')))->render(); ?>